<!DOCTYPE html>
<html>
  <head>
    <title>Ceagle-I: CI from Eagle Eye</title>
    <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" title="no title" charset="utf-8">
  </head>
  <body>
    <div id="container" class="packery js-packery" data-packery-options='{"itemSelector": ".item", "gutter": 10}'>
      <div class="gutter-sizer"></div>
    </div>
    <script src="js/jquery-2.0.3.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/jquery-ext.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/packery.pkgd.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
    $(function(){
      if (typeof(Worker) === 'undefined') {
        throw 'Sorry, No Worker Support for Your Browser. Please Use the Latest Version of Chrome or Firefox or Safari'
      }
      
      monitor = new Worker('js/ci.monitor.js');
      
      monitor.onmessage = function(event) {
        $.each(event.data, function(index, value) {
          $.getJSON(value.url+'/lastBuild/api/json', function(data2) {
            if ($('div[data-jobname="'+value.name+'"]').length) {
              if (data2.building == 'true') {
                $('div[data-jobname="'+value.name+'"]').removeClass('success failed').addClass('building');
              } else {
                $('div[data-jobname="'+value.name+'"]').removeClass('success failed').addClass(data2.result.toLowerCase());
              }
            } else {
              var box = document.createElement('div');
              box.className = 'item has-padding '+data2.result.toLowerCase();
              box.dataset.jobname = value.name;
              box.innerText = value.name
              box.style.width = parseInt($.textWidth(value.name))+40+'px'
              
              $('#container').append(box);
            }
          });
          
        });
      };
      
      $.getJSON('http://ci.jruby.org/api/json/', function(data) {
        var activeJobs = $.grep(data.jobs, function(value){
          return value.color !== 'disabled'
        });
        monitor.postMessage(activeJobs);
      });
    });
    </script>
  </body>
</html> 